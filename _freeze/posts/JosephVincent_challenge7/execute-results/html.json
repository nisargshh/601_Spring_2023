{
  "hash": "75105854bf703beeb28835220d234318",
  "result": {
    "markdown": "---\ntitle: \"Challenge 7 - Hotel Bookings\"\nauthor: \"Joseph Vincent\"\ndescription: \"Visualizing Multiple Dimensions\"\ndate: \"04/23/2023\"\nformat:\n  html:\n    toc: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - challenge_7\n  - hotel_bookings\n  - JosephVincent\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(lubridate)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n## Read in data (hotel bookings)\n\n  - hotel_bookings ⭐⭐⭐\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhoteldata <- read.csv(\"_data/hotel_bookings.csv\")\nhead(hoteldata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         hotel is_canceled lead_time arrival_date_year arrival_date_month\n1 Resort Hotel           0       342              2015               July\n2 Resort Hotel           0       737              2015               July\n3 Resort Hotel           0         7              2015               July\n4 Resort Hotel           0        13              2015               July\n5 Resort Hotel           0        14              2015               July\n6 Resort Hotel           0        14              2015               July\n  arrival_date_week_number arrival_date_day_of_month stays_in_weekend_nights\n1                       27                         1                       0\n2                       27                         1                       0\n3                       27                         1                       0\n4                       27                         1                       0\n5                       27                         1                       0\n6                       27                         1                       0\n  stays_in_week_nights adults children babies meal country market_segment\n1                    0      2        0      0   BB     PRT         Direct\n2                    0      2        0      0   BB     PRT         Direct\n3                    1      1        0      0   BB     GBR         Direct\n4                    1      1        0      0   BB     GBR      Corporate\n5                    2      2        0      0   BB     GBR      Online TA\n6                    2      2        0      0   BB     GBR      Online TA\n  distribution_channel is_repeated_guest previous_cancellations\n1               Direct                 0                      0\n2               Direct                 0                      0\n3               Direct                 0                      0\n4            Corporate                 0                      0\n5                TA/TO                 0                      0\n6                TA/TO                 0                      0\n  previous_bookings_not_canceled reserved_room_type assigned_room_type\n1                              0                  C                  C\n2                              0                  C                  C\n3                              0                  A                  C\n4                              0                  A                  A\n5                              0                  A                  A\n6                              0                  A                  A\n  booking_changes deposit_type agent company days_in_waiting_list customer_type\n1               3   No Deposit  NULL    NULL                    0     Transient\n2               4   No Deposit  NULL    NULL                    0     Transient\n3               0   No Deposit  NULL    NULL                    0     Transient\n4               0   No Deposit   304    NULL                    0     Transient\n5               0   No Deposit   240    NULL                    0     Transient\n6               0   No Deposit   240    NULL                    0     Transient\n  adr required_car_parking_spaces total_of_special_requests reservation_status\n1   0                           0                         0          Check-Out\n2   0                           0                         0          Check-Out\n3  75                           0                         0          Check-Out\n4  75                           0                         0          Check-Out\n5  98                           0                         1          Check-Out\n6  98                           0                         1          Check-Out\n  reservation_status_date\n1              2015-07-01\n2              2015-07-01\n3              2015-07-02\n4              2015-07-02\n5              2015-07-03\n6              2015-07-03\n```\n:::\n\n```{.r .cell-code}\ndim(hoteldata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 119390     32\n```\n:::\n:::\n\n\n### Briefly describe the data\n\nThe data set consists of information about hotel stays between July 2015 and August 2017.\nThere are 33 variables and over 100,000 stays.\n\nSome of the key variables worth mentioning are:\n\n* Type of hotel (either Resort Hotel or City Hotel) - presumably this is data from a booking service that has multiple hotel customers\n\n* Arrival date, which is broken into several columns including year, month, day, week, etc.\n* Occupants of each stay (adults, children, babies)\n\n* Market segments and distribution channels\n\n* Average daily rate (ADR) - from some research this seems to be the average rate across all rooms for a given date\n\n* Lead time - or the time from booking to arrival\n\n## Tidy Data (as needed) and Mutating\n\nOne of the main problems with the data set for analysis purposes is that the arrival date is broken into various character columns. To fix this, I mutated the the arrival month names into numeric values, and then used lubridate to create a new single column for arrival date in the proper format.\n\nSome of the variables (such as whether the stay was canceled, or whether it was a repeat guest) were in binary (0,1) format. I converted these into logical TRUE/FALSE variables.\n\nI also created a new column for total nights stayed, which combined week and weekend nights stayed.\n\nAfter completing these steps I would expect to see:\n33(original) - 4 (individual arrival date columns) + 1 (new arrival date) + 1 (custom arrival date with month only for further anlysis) = 31 columns\nWhich is confirmed by my sanity check below.\n\nYou can also see that the new \"arrival_date\" column is in date format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#converting months to numerics to use in make date\nhoteldatatidy <- hoteldata %>%\n  mutate(monthnumeric = case_when(\n    `arrival_date_month` == \"January\" ~ 1,\n    `arrival_date_month` == \"February\" ~ 2,\n    `arrival_date_month` == \"March\" ~ 3,\n    `arrival_date_month` == \"April\" ~ 4,\n    `arrival_date_month` == \"May\" ~ 5,\n    `arrival_date_month` == \"June\" ~ 6,\n    `arrival_date_month` == \"July\" ~ 7,\n    `arrival_date_month` == \"August\" ~ 8,\n    `arrival_date_month` == \"September\" ~ 9,\n    `arrival_date_month` == \"October\" ~ 10,\n    `arrival_date_month` == \"November\" ~ 11,\n    `arrival_date_month` == \"December\" ~ 12)) %>%\n  \n  #turning separate arrival date columns into a single arrival date\n  mutate(arrival_date = make_date(year = arrival_date_year, month = monthnumeric, day = arrival_date_day_of_month)) %>%\n  \n  #making custom month-only column\n  mutate(arrival_month = make_date(year = arrival_date_year, month = monthnumeric)) %>%\n  \n  #mutating binary 0/1 columns to be TRUE/FALSE\n  mutate(is_canceled = case_when(\n    `is_canceled` == 0 ~ FALSE,\n    `is_canceled` == 1 ~ TRUE,)) %>%\n  mutate(is_repeated_guest = case_when(\n    `is_repeated_guest` == 0 ~ FALSE,\n    `is_repeated_guest` == 1 ~ TRUE,)) %>%\n  \n  #combining week and weekend nights stayed for a total column\n  mutate(total_nights_stayed = stays_in_weekend_nights + stays_in_week_nights) %>%\n  \n  #deselecting unused columns\n  select(-c(`monthnumeric`, `arrival_date_day_of_month`, `arrival_date_week_number`, `arrival_date_month`, `arrival_date_year`))\n\n#doing some sanity checks\nhead(hoteldatatidy$arrival_date)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2015-07-01\" \"2015-07-01\" \"2015-07-01\" \"2015-07-01\" \"2015-07-01\"\n[6] \"2015-07-01\"\n```\n:::\n\n```{.r .cell-code}\ndim(hoteldatatidy)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 119390     31\n```\n:::\n:::\n\n\n##Preparing data for visualization\n\nBefore creating a time series visualization, I wanted to create a summary table, showing the means of key values like Lead Time, ADR and Total Nights Stayed, grouped by hotel type.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmonthlymeansbyhoteltype <- hoteldatatidy %>%\n  group_by(arrival_month, hotel) %>%\n  summarize(mean_lead_time = mean(lead_time),\n            mean_adr = mean(adr),\n            mean_stay = mean(total_nights_stayed))\nhead(monthlymeansbyhoteltype)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n# Groups:   arrival_month [3]\n  arrival_month hotel        mean_lead_time mean_adr mean_stay\n  <date>        <chr>                 <dbl>    <dbl>     <dbl>\n1 2015-07-01    City Hotel            181.      69.8      2.69\n2 2015-07-01    Resort Hotel           70.5    126.       5.06\n3 2015-08-01    City Hotel            114.      77.7      2.72\n4 2015-08-01    Resort Hotel           74.3    156.       5.43\n5 2015-09-01    City Hotel            114.     101.       2.73\n6 2015-09-01    Resort Hotel          144.      80.9      5.13\n```\n:::\n:::\n\n\n## Visualization with Multiple Dimensions\n\nAs we saw in the previous challenge, mean Lead Time and ADR tracked each other closely, tending to rise in the busier summer months and fall in the winter months.\n\nTo expand upon this, I'd like to add the additional dimensions of hotel type (city vs resort) and mean length of stay to see if they follow the similar trends.\n\n### Mean lead time by month and hotel type\n\nUsing our means table, below I have plotted a time-series chart of mean lead time, with each line representing a hotel type. They trend similarly over time, though the lead times for the resort hotel appear to be slightly more extreme in either direction. Particularly in the winter months, lead time for the resort hotel is quite low. This makes sense, as you'd expect that people might not plan far in advance for a resort trip in the winter.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#creating a ggplot using monthlymeans table\n#setting the x axis as arrival date\nleadtimebyhotel <- ggplot(monthlymeansbyhoteltype, aes(x = arrival_month, y = mean_lead_time, color = hotel)) + \n  \n  geom_line() +\n  \n  #setting y scale and creating an additional y axis on the right side\n  scale_y_continuous(name = \"Mean Lead Time (Days)\") +\n  scale_x_date(date_labels = \"%b %y\", date_breaks = \"2 months\", name = \"Month\") +\n  \n  #setting theme options\n  theme_minimal() +\n  theme(axis.text.x=element_text(angle=60, hjust=1)) +\n  ggtitle(\"Mean Lead Time by Month and Hotel\")\n\n#plotting\nleadtimebyhotel\n```\n\n::: {.cell-output-display}\n![](JosephVincent_challenge7_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Mean lead time by month and hotel type, scaled by stay length\n\nTo take this a step further, I will look at whether stay length is also greater during months when lead time is.\n\nBelow I've graphed the same data as before, but this time used points to represent each monthly mean. Triangles represent the resort hotel, while circles represent the city hotel. \n\nAs you can see from the stay length scale (and color gradient) the mean resort hotel stays tend to be longer than the city hotel stays. The hotel stays in general seem to be longer during the summer months, but this is much clearer for the resort stays.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleadtimeandstay <- ggplot(monthlymeansbyhoteltype, aes(x = arrival_month, y = mean_lead_time, size = mean_stay, color = mean_stay, shape = hotel)) + \n  \n  geom_point() +\n  \n    #setting y scale and creating an additional y axis on the right side\n  scale_y_continuous(name = \"Mean Lead Time (Days)\") +\n  scale_x_date(date_labels = \"%b %y\", date_breaks = \"2 months\", name = \"Month\") +\n\n  #setting theme options\n  theme_minimal() +\n  theme(axis.text.x=element_text(angle=60, hjust=1)) +\n  ggtitle(\"Mean Lead Time by Month (Scaled by Length of Stay)\") +\n  guides(color = FALSE) + \n  labs(size = \"Mean Length of Stay\")\n\nleadtimeandstay\n```\n\n::: {.cell-output-display}\n![](JosephVincent_challenge7_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n### Mean ADR by month and hotel type, scaled by stay length\n\nFinally, I'll look at the same graph but by ADR instead of lead time. \n\nThis results in some interesting findings. The Mean ADR varies much more in for the resort hotel than the city hotel, with the summer \"peaks\" and winter \"valleys\" being very pronounced vs the relatively smoother shape of the city hotel ADR plot.\n\nLength of stay is still clearly greater during the summer months for the resort hotel, while length of stay remains relatively consistent throughout the year for the city hotel.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadrandstay <- ggplot(monthlymeansbyhoteltype, aes(x = arrival_month, y = mean_adr, size = mean_stay, color = mean_stay, shape = hotel)) + \n  \n  geom_point() +\n  \n    #setting y scale and creating an additional y axis on the right side\n  scale_y_continuous(name = \"Mean ADR\") +\n  scale_x_date(date_labels = \"%b %y\", date_breaks = \"2 months\", name = \"Month\") +\n\n  #setting theme options\n  theme_minimal() +\n  theme(axis.text.x=element_text(angle=60, hjust=1)) +\n  ggtitle(\"Mean ADR by Month (Scaled by Length of Stay)\") +\n  guides(color = FALSE) + \n  labs(size = \"Mean Length of Stay\")\n\nadrandstay\n```\n\n::: {.cell-output-display}\n![](JosephVincent_challenge7_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::",
    "supporting": [
      "JosephVincent_challenge7_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}