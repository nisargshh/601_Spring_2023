{
  "hash": "efd11878694d122e73b68b64b7138b08",
  "result": {
    "markdown": "---\ntitle: \"Challenge 6: Airbnb in NYC\"\nauthor: \"Justine Shakespeare\"\ndescription: \"Visualizing Time and Relationships\"\ndate: \"04/05/2023\"\nformat:\n  html:\n    toc: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - challenge_6\n  - Justine Shakespeare\n  - air_bnb\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(treemap)\nlibrary(treemapify)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n### Load the Data\n\nLet's look at the Airbnb data from New York again.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAirbnb_NYC <- read_csv(\"_data/AB_NYC_2019.csv\")\nglimpse(Airbnb_NYC)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 48,895\nColumns: 16\n$ id                             <dbl> 2539, 2595, 3647, 3831, 5022, 5099, 512…\n$ name                           <chr> \"Clean & quiet apt home by the park\", \"…\n$ host_id                        <dbl> 2787, 2845, 4632, 4869, 7192, 7322, 735…\n$ host_name                      <chr> \"John\", \"Jennifer\", \"Elisabeth\", \"LisaR…\n$ neighbourhood_group            <chr> \"Brooklyn\", \"Manhattan\", \"Manhattan\", \"…\n$ neighbourhood                  <chr> \"Kensington\", \"Midtown\", \"Harlem\", \"Cli…\n$ latitude                       <dbl> 40.64749, 40.75362, 40.80902, 40.68514,…\n$ longitude                      <dbl> -73.97237, -73.98377, -73.94190, -73.95…\n$ room_type                      <chr> \"Private room\", \"Entire home/apt\", \"Pri…\n$ price                          <dbl> 149, 225, 150, 89, 80, 200, 60, 79, 79,…\n$ minimum_nights                 <dbl> 1, 1, 3, 1, 10, 3, 45, 2, 2, 1, 5, 2, 4…\n$ number_of_reviews              <dbl> 9, 45, 0, 270, 9, 74, 49, 430, 118, 160…\n$ last_review                    <date> 2018-10-19, 2019-05-21, NA, 2019-07-05…\n$ reviews_per_month              <dbl> 0.21, 0.38, NA, 4.64, 0.10, 0.59, 0.40,…\n$ calculated_host_listings_count <dbl> 6, 2, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 3, …\n$ availability_365               <dbl> 365, 355, 365, 194, 0, 129, 0, 220, 0, …\n```\n:::\n:::\n\n### Data Description\n\nThis data looks to be Airbnb rentals in New York City in 2019, with each observation representing one rental unit. There are almost 49,000 observations and 16 variables. The variables provide information about each unit, including: the id and name of the unit, the hosts (id and name of the host) the location (including neighborhood, city borough, and longitude and latitude), the room type, the price, the number of minimum nights required for a reservation, the number of reviews, date of last review, average reviews per month, something called a \"calculated_host_listings_count\" (possibly a count of how many listings the host has with Airbnb) and availability (I'm guessing this is how many days of the year the unit is available). \n\nThis data looks pretty tidy already. The only thing we'll likely want to do is focus on a subset of the data, since we discovered furing challenge #5 that there are some outliers in the data. As a reminder, let's look at the spread of the price variable. The first time I did this it showed \\$0 as the lowest price. Given that these are likely some sort of error or at least don't represent live listings, let's filter those units out so they don't skew the quantiles.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAirbnb_NYC %>% \n  filter(price != 0) %>% \n  summarize(\"lowest\" = min(price, na.rm = TRUE),\n            \"25th quantile\" = quantile(price, probs = .25), \n            \"median\" = median(price, na.rm = TRUE), \n            \"75th quantile\" = quantile(price, probs = .75),\n            \"99 quantile\" = quantile(price, .99),\n            \"highest\" = max(price, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 6\n  lowest `25th quantile` median `75th quantile` `99 quantile` highest\n   <dbl>           <dbl>  <dbl>           <dbl>         <dbl>   <dbl>\n1     10              69    106             175           799   10000\n```\n:::\n:::\n\nEven with the \\$0 priced units removed, it's still the case that the price in the 99th percentile is \\$799. For that reason I think it's safe to just focus on prices below \\$1,000. We know that we're still looking at over 99% of the data.\n\nLet's filter for just prices under \\$1,000 and then take another look at the data that remains.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nABNYC_filtered <- Airbnb_NYC %>% \n  filter(price != 0 & price < 1000)\n\nABNYC_filtered %>% \n  summarize(\"lowest\" = min(price, na.rm = TRUE),\n            \"25th quantile\" = quantile(price, probs = .25), \n            \"median\" = median(price, na.rm = TRUE), \n            \"75th quantile\" = quantile(price, probs = .75),\n            \"99 quantile\" = quantile(price, .99),\n            \"highest\" = max(price, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 6\n  lowest `25th quantile` median `75th quantile` `99 quantile` highest\n   <dbl>           <dbl>  <dbl>           <dbl>         <dbl>   <dbl>\n1     10              69    105             175           600     999\n```\n:::\n:::\n\nSince we'll be focusing on time series visualizations, let's make sure the last_review variable is a date.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nABNYC_filtered$last_review <- as.Date(ABNYC_filtered$last_review)\n\nglimpse(ABNYC_filtered)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 48,586\nColumns: 16\n$ id                             <dbl> 2539, 2595, 3647, 3831, 5022, 5099, 512…\n$ name                           <chr> \"Clean & quiet apt home by the park\", \"…\n$ host_id                        <dbl> 2787, 2845, 4632, 4869, 7192, 7322, 735…\n$ host_name                      <chr> \"John\", \"Jennifer\", \"Elisabeth\", \"LisaR…\n$ neighbourhood_group            <chr> \"Brooklyn\", \"Manhattan\", \"Manhattan\", \"…\n$ neighbourhood                  <chr> \"Kensington\", \"Midtown\", \"Harlem\", \"Cli…\n$ latitude                       <dbl> 40.64749, 40.75362, 40.80902, 40.68514,…\n$ longitude                      <dbl> -73.97237, -73.98377, -73.94190, -73.95…\n$ room_type                      <chr> \"Private room\", \"Entire home/apt\", \"Pri…\n$ price                          <dbl> 149, 225, 150, 89, 80, 200, 60, 79, 79,…\n$ minimum_nights                 <dbl> 1, 1, 3, 1, 10, 3, 45, 2, 2, 1, 5, 2, 4…\n$ number_of_reviews              <dbl> 9, 45, 0, 270, 9, 74, 49, 430, 118, 160…\n$ last_review                    <date> 2018-10-19, 2019-05-21, NA, 2019-07-05…\n$ reviews_per_month              <dbl> 0.21, 0.38, NA, 4.64, 0.10, 0.59, 0.40,…\n$ calculated_host_listings_count <dbl> 6, 2, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 3, …\n$ availability_365               <dbl> 365, 355, 365, 194, 0, 129, 0, 220, 0, …\n```\n:::\n:::\n\n\n## Time Dependent Visualization\n\nLet's take a look at a histogram of the date of the last review to get a sense of the distribution of this data. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(ABNYC_filtered, aes(last_review)) + \n  geom_histogram(fill = \"cornflowerblue\") + labs(title = \"Last Review Date\", \n                          x = \"Date of Last Review\", y = \"Count of Reviews\")\n```\n\n::: {.cell-output-display}\n![](JustineShakespeare_Challenge6_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nIt looks like most of the units in this dataset were last reviewed in 2019 (the most recent year in the dataset). There look to be a few units that were last reviewed as early as 2012. Let's try plotting the last_review variable alongside the number_of_reviews variable with `geom_line()`. We'll filter so that we're just looking at data after 2014. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nABNYC_filtered %>% \n  filter(as.Date(last_review) > as.Date(\"2014-01-01\")) %>% \n  ggplot(aes(last_review, number_of_reviews)) + \n  geom_line(color = \"darkslategray4\") + \n  labs(title = \"Number of Reviews by Date of Last Review\", \n       x = \"Date of Last Review\", y = \"Number of Reviews\")\n```\n\n::: {.cell-output-display}\n![](JustineShakespeare_Challenge6_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\nThis graph shows a similar trend to the graph above - there are more reviews in more recent years. \n\nIs there a relationship between type of room and the number and date of last reviews?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nABNYC_filtered %>% \n  filter(as.Date(last_review) > as.Date(\"2014-01-01\")) %>% \n  ggplot(aes(last_review, number_of_reviews)) + \n  geom_point(color = \"brown1\") + \n  labs(title = \"Number of Reviews by Date of Last Review\", \n       x = \"Date of Last Review\", y = \"Number of Reviews\") + \n  theme_bw() + facet_wrap(vars(room_type))\n```\n\n::: {.cell-output-display}\n![](JustineShakespeare_Challenge6_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\nThere look to be less reviews of shared rooms than entire home/apartments or private rooms, but this likely reflects the fact that there are less shared rooms in the data. \n\n## Visualizing Part-Whole Relationships\n\nLet's try making a treemap that shows the number of Airbnb units by NYC borough:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nABNYC_filtered %>% \n  count(neighbourhood_group) %>% \n  ggplot(aes(area= n, fill= neighbourhood_group, label = neighbourhood_group)) + \n  geom_treemap() + \n  labs(title = \"Treemap of Airbnb Units by NYC Borough\") + \n  scale_fill_discrete(name = \"Borough\") +\n  geom_treemap_text(colour = \"darkslategray\",\n                    place = \"centre\")\n```\n\n::: {.cell-output-display}\n![](JustineShakespeare_Challenge6_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nI'd like to create subgroups here with the relevant neighborhoods within each borough, but I'm not sure how to do that...\n\nLet's use `geom_bar()` to look at the number of Airbnb units by borough and room type.\n\n::: {.cell}\n\n```{.r .cell-code}\ncolors <- c(\"darkgoldenrod1\", \"coral\", \"brown1\")\n\nggplot(ABNYC_filtered, aes(neighbourhood_group, fill = room_type)) +\n  geom_bar(stat = \"count\") + \n  labs(title = \"Number of Airbnb Units in each NYC Borough\", \n       x = \"Borough\", \n       y = \"Number of Units\") + \n  scale_fill_manual(name = \"Room Type\", values = colors) +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](JustineShakespeare_Challenge6_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\nThis chart gives us a sense of the overall number of units in each borough (we can see the most are in Manhattan and Brooklyn), and of those, the proportion of different room types (very few are shared rooms).\n\nFinally, another attempt at the map (thanks Erico and Sue-Ellen for the idea and original code!).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(Airbnb_NYC, aes(longitude, latitude, color = neighbourhood_group), \n       group = neighbourhood_group) + geom_point() + \n  labs(title = \"Airbnb Listings in NYC by Borough\", color = \"Borough\")\n```\n\n::: {.cell-output-display}\n![](JustineShakespeare_Challenge6_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "JustineShakespeare_Challenge6_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}